<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë“œê²Œì„ ë ˆì´íŒ… ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .section {
            padding: 30px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        h2 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .icon {
            font-size: 1.5em;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .player-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .player-tag {
            padding: 8px 16px;
            background: #f0f0f0;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .player-tag .remove {
            cursor: pointer;
            color: #999;
            font-weight: bold;
        }
        
        .player-tag .remove:hover {
            color: #ff4444;
        }
        
        .game-input {
            margin-top: 20px;
        }
        
        .rank-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 8px;
        }
        
        .rank-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        select {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .ranking-table th,
        .ranking-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .ranking-table th {
            background: #f8f8f8;
            font-weight: 600;
        }
        
        .ranking-table tr:hover {
            background: #f8f8f8;
        }
        
        .rank-medal {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .rank-1 { background: gold; color: #333; }
        .rank-2 { background: silver; color: #333; }
        .rank-3 { background: #CD7F32; }
        .rank-other { background: #999; }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            flex: 1;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ² ë³´ë“œê²Œì„ ë ˆì´íŒ… ì‹œìŠ¤í…œ</h1>
            <p>TrueSkill ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì‹¤ë ¥ì„ ì¸¡ì •í•´ë³´ì„¸ìš”!</p>
        </div>
        
        <div class="section">
            <h2>
                <span class="icon">ğŸ‘¥</span>
                í”Œë ˆì´ì–´ ê´€ë¦¬
            </h2>
            <div class="input-group">
                <input type="text" id="playerNameInput" placeholder="í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                <button onclick="addPlayer()">ì¶”ê°€</button>
            </div>
            <div class="player-list" id="playerList"></div>
        </div>
        
        <div class="section">
            <h2>
                <span class="icon">ğŸ®</span>
                ê²Œì„ ê²°ê³¼ ì…ë ¥
            </h2>
            <div id="gameInput" class="game-input"></div>
            <button onclick="recordGame()" style="width: 100%; margin-top: 20px;">ê²Œì„ ê²°ê³¼ ê¸°ë¡</button>
        </div>
        
        <div class="section">
            <h2>
                <span class="icon">ğŸ†</span>
                ìˆœìœ„í‘œ
            </h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">ì´ ê²Œì„ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalPlayers">0</div>
                    <div class="stat-label">ì´ í”Œë ˆì´ì–´ ìˆ˜</div>
                </div>
            </div>
            <div id="rankingTable"></div>
        </div>
    </div>
    
    <script>
        // Simple TrueSkill implementation
        class Rating {
            constructor(mu = 25, sigma = 25/3) {
                this.mu = mu;
                this.sigma = sigma;
            }
        }
        
        class TrueSkillSimple {
            constructor() {
                this.players = {};
                this.gameHistory = [];
            }
            
            addPlayer(name) {
                if (!this.players[name]) {
                    this.players[name] = {
                        rating: new Rating(),
                        games: 0,
                        wins: 0
                    };
                    this.saveToStorage();
                }
            }
            
            removePlayer(name) {
                delete this.players[name];
                this.saveToStorage();
            }
            
            recordGame(rankings) {
                // ê°„ë‹¨í•œ TrueSkill ê·¼ì‚¬
                const K = 32; // ELO-like K factor
                
                rankings.forEach((playerName, rank) => {
                    if (!this.players[playerName]) return;
                    
                    const player = this.players[playerName];
                    player.games++;
                    
                    if (rank === 0) player.wins++;
                    
                    // ê° í”Œë ˆì´ì–´ì™€ì˜ ë§¤ì¹˜ì—… ê³„ì‚°
                    rankings.forEach((opponentName, opponentRank) => {
                        if (playerName === opponentName) return;
                        
                        const opponent = this.players[opponentName];
                        const ratingDiff = opponent.rating.mu - player.rating.mu;
                        const expectedScore = 1 / (1 + Math.pow(10, ratingDiff / 400));
                        const actualScore = rank < opponentRank ? 1 : 0;
                        
                        // ë ˆì´íŒ… ì—…ë°ì´íŠ¸
                        const change = K * (actualScore - expectedScore) / rankings.length;
                        player.rating.mu += change;
                    });
                    
                    // ì‹œê·¸ë§ˆ ê°ì†Œ (ê²Œì„í• ìˆ˜ë¡ í™•ì‹¤í•´ì§)
                    player.rating.sigma = Math.max(2, player.rating.sigma * 0.99);
                });
                
                // ê²Œì„ ê¸°ë¡ ì €ì¥
                this.gameHistory.push({
                    date: new Date().toISOString(),
                    rankings: rankings
                });
                
                this.saveToStorage();
            }
            
            getDisplayRating(playerName) {
                const player = this.players[playerName];
                if (!player) return 0;
                return Math.round((player.rating.mu - 3 * player.rating.sigma) * 40);
            }
            
            getRankings() {
                return Object.entries(this.players)
                    .map(([name, data]) => ({
                        name,
                        score: this.getDisplayRating(name),
                        games: data.games,
                        wins: data.wins,
                        winRate: data.games > 0 ? Math.round(data.wins / data.games * 100) : 0
                    }))
                    .sort((a, b) => b.score - a.score);
            }
            
            saveToStorage() {
                localStorage.setItem('trueskillData', JSON.stringify({
                    players: this.players,
                    gameHistory: this.gameHistory
                }));
            }
            
            loadFromStorage() {
                const data = localStorage.getItem('trueskillData');
                if (data) {
                    const parsed = JSON.parse(data);
                    this.players = parsed.players || {};
                    this.gameHistory = parsed.gameHistory || [];
                    
                    // Rating ê°ì²´ ë³µì›
                    Object.values(this.players).forEach(player => {
                        player.rating = new Rating(player.rating.mu, player.rating.sigma);
                    });
                }
            }
        }
        
        // ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
        const game = new TrueSkillSimple();
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            game.loadFromStorage();
            updatePlayerList();
            updateGameInput();
            updateRankingTable();
        };
        
        // ì—”í„°í‚¤ë¡œ í”Œë ˆì´ì–´ ì¶”ê°€
        document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });
        
        function addPlayer() {
            const input = document.getElementById('playerNameInput');
            const name = input.value.trim();
            
            if (name && !game.players[name]) {
                game.addPlayer(name);
                input.value = '';
                updatePlayerList();
                updateGameInput();
                updateRankingTable();
            }
        }
        
        function removePlayer(name) {
            if (confirm(`${name} í”Œë ˆì´ì–´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                game.removePlayer(name);
                updatePlayerList();
                updateGameInput();
                updateRankingTable();
            }
        }
        
        function updatePlayerList() {
            const list = document.getElementById('playerList');
            const players = Object.keys(game.players);
            
            if (players.length === 0) {
                list.innerHTML = '<div class="empty-state">ë“±ë¡ëœ í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                list.innerHTML = players.map(name => `
                    <div class="player-tag">
                        ${name}
                        <span class="remove" onclick="removePlayer('${name}')">âœ•</span>
                    </div>
                `).join('');
            }
            
            document.getElementById('totalPlayers').textContent = players.length;
        }
        
        function updateGameInput() {
            const container = document.getElementById('gameInput');
            const players = Object.keys(game.players);
            
            if (players.length < 2) {
                container.innerHTML = '<div class="empty-state">ìµœì†Œ 2ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤</div>';
            } else {
                container.innerHTML = Array.from({length: players.length}, (_, i) => `
                    <div class="rank-input">
                        <div class="rank-number">${i + 1}ë“±</div>
                        <select id="rank${i}">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            ${players.map(name => `<option value="${name}">${name}</option>`).join('')}
                        </select>
                    </div>
                `).join('');
            }
        }
        
        function recordGame() {
            const players = Object.keys(game.players);
            const rankings = [];
            const selected = new Set();
            
            for (let i = 0; i < players.length; i++) {
                const select = document.getElementById(`rank${i}`);
                if (!select || !select.value) {
                    alert('ëª¨ë“  ìˆœìœ„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                if (selected.has(select.value)) {
                    alert('ê°™ì€ í”Œë ˆì´ì–´ë¥¼ ì—¬ëŸ¬ ìˆœìœ„ì— ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                rankings.push(select.value);
                selected.add(select.value);
            }
            
            game.recordGame(rankings);
            updateRankingTable();
            updateGameInput();
            
            // ì…ë ¥ ì´ˆê¸°í™”
            for (let i = 0; i < players.length; i++) {
                document.getElementById(`rank${i}`).value = '';
            }
            
            alert('ê²Œì„ ê²°ê³¼ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function updateRankingTable() {
            const container = document.getElementById('rankingTable');
            const rankings = game.getRankings();
            
            document.getElementById('totalGames').textContent = game.gameHistory.length;
            
            if (rankings.length === 0) {
                container.innerHTML = '<div class="empty-state">ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
                container.innerHTML = `
                    <table class="ranking-table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>í”Œë ˆì´ì–´</th>
                                <th>ë ˆì´íŒ…</th>
                                <th>ê²Œì„ ìˆ˜</th>
                                <th>ìŠ¹ë¦¬</th>
                                <th>ìŠ¹ë¥ </th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rankings.map((player, index) => `
                                <tr>
                                    <td>
                                        <div class="rank-medal ${index < 3 ? `rank-${index + 1}` : 'rank-other'}">
                                            ${index + 1}
                                        </div>
                                    </td>
                                    <td><strong>${player.name}</strong></td>
                                    <td>${player.score}</td>
                                    <td>${player.games}</td>
                                    <td>${player.wins}</td>
                                    <td>${player.winRate}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }
    </script>
</body>
</html>
